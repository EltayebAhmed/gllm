
services:
  balancer:
    extends:
      file: compose_base.yml
      service: balancer

  worker1:
    extends:
      file: compose_base.yml
      service: worker_base
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
              driver: nvidia
              device_ids: ['0']
    environment:
      - ROUTER_ADDRESS=http://127.0.0.1:${SERVER_PORT}
      - SELF_HOSTNAME=127.0.0.1
      - PORT=8900
      - VLLM_PORT=8901
      - HF_TOKEN=${HF_TOKEN}

  worker2:
    extends:
      file: compose_base.yml
      service: worker_base
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
              driver: nvidia
              device_ids: ['1']
    environment:
      - ROUTER_ADDRESS=http://127.0.0.1:${SERVER_PORT}
      - SELF_HOSTNAME=127.0.0.1
      - PORT=9900
      - VLLM_PORT=9901
      - HF_TOKEN=${HF_TOKEN}


  worker3:
    extends:
      file: compose_base.yml
      service: worker_base
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
              driver: nvidia
              device_ids: ['2']
    environment:
      - ROUTER_ADDRESS=http://127.0.0.1:${SERVER_PORT}
      - SELF_HOSTNAME=127.0.0.1
      - PORT=9500
      - VLLM_PORT=9501
      - HF_TOKEN=${HF_TOKEN}


  worker4:
    extends:
      file: compose_base.yml
      service: worker_base
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [gpu]
              driver: nvidia
              device_ids: ['3']
    environment:
      - ROUTER_ADDRESS=http://127.0.0.1:${SERVER_PORT}
      - SELF_HOSTNAME=127.0.0.1
      - PORT=9320
      - VLLM_PORT=9321
      - HF_TOKEN=${HF_TOKEN}
